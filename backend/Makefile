.PHONY: help docker-build docker-up docker-down docker-logs docker-restart docker-clean test

help: ## Affiche l'aide
	@echo "Commandes disponibles:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

docker-build: ## Construire les images Docker
	docker compose build

docker-up: ## D√©marrer les services Docker
	docker compose up -d

docker-down: ## Arr√™ter les services Docker
	docker compose down

docker-logs: ## Voir les logs des services
	docker compose logs -f

docker-restart: ## Red√©marrer les services
	docker compose restart

docker-clean: ## Nettoyer compl√®tement (supprime volumes)
	docker compose down -v

docker-rebuild: ## Reconstruire et red√©marrer
	docker compose build --no-cache
	docker compose up -d

test: ## Tester l'API
	@echo "Test du health check..."
	@curl -s http://localhost:8080/health || echo "‚ùå Le serveur n'est pas d√©marr√©"
	@echo ""
	@echo "√âtat des conteneurs:"
	@docker compose ps

start: docker-build docker-up ## Construire et d√©marrer (commande compl√®te)
	@echo "‚úÖ Services d√©marr√©s !"
	@echo "üìç API: http://localhost:8080"
	@echo "üìç WebSocket: ws://localhost:8080/ws"
	@echo ""
	@echo "Pour voir les logs: make docker-logs"

stop: docker-down ## Arr√™ter les services
